# 第1章 概述

比较重要的就几个

## 1.1 计算机网络的性能指标

1.速率

比特（bit）是计算机中数量的单位。一个bit是一个**二进制位**，简单理解就是一个0或者一个1.

速率即数据率或比特率。单位是b/s or kb/s or Mb/s or Gb/s

2.带宽

带宽是指信号具有的频带宽度，单位是赫...

网络当中的带宽是指**数字信道所能够传送的最高数据率**，单位是b/s（bit/s）

注：为什么在ISP给的网络带宽有多大多大，而实际用起来发现速度值远远达不到那个程度呢。。？

因为两者的单位根本就不一样

一个是比特，一个是字节。两者相差8倍，然后再加上实际网络当中的各种影响，就差不多是10倍的差距啦。

3.吞吐量

吞吐量标识在单位时间内通过某个网络（或信道、接口）的数据量。。

吞吐量受带宽或额定速率的限制。

4.时延

时延分为发送时延和传播时延等。

发送时延是指：网卡将10bit的数据放到物理线路上面所需要的时间（因为不可能数据直接全部一下子放到信道上面，需要一个个发）。

![image-20200307200128715](C:\Users\45928\AppData\Roaming\Typora\typora-user-images\image-20200307200128715.png)

传播时延是指：数据在信道上传播所需要的时间。

![image-20200307200140029](C:\Users\45928\AppData\Roaming\Typora\typora-user-images\image-20200307200140029.png)

当然，还有其他时延，比如处理时延、排队时延。

排队时延：当信道中数据量比较多的情况下，有很多数据都到达了路由器的一个端口，然而路由器没有办法一下子处理完毕，所以需要让这些数据进行排队等待处理。

处理时延：路由器处理数据，比如拆包装包，都需要时间，这个就是处理时延。



所以，综上所述。

![image-20200307200447191](C:\Users\45928\AppData\Roaming\Typora\typora-user-images\image-20200307200447191.png)

5.时延带宽积

链路的时延带宽积又称为以比特为单位的链路长度

![image-20200307200558878](C:\Users\45928\AppData\Roaming\Typora\typora-user-images\image-20200307200558878.png)

对于高速网络链路，我们提高的仅仅是数据的发送速率，而不是比特在链路上面的传播速率。例如光纤和铜线传输。传输的速率光纤没有铜线快，但是光纤的带宽比铜线快。铜线若发送过快，频率就会很高，接收端就会无法识别。

6.信道利用率

信道利用率支出某信道有及百分之几的时间是被利用的（有数据通过）。完全空闲的信道利用率为0.

网络利用率是全网络的信道利用率的加权平均值。

**信道利用率不是越高越好**

公式如下：

![image-20200307200854440](C:\Users\45928\AppData\Roaming\Typora\typora-user-images\image-20200307200854440.png)

时延和利用率的函数关系图如下：

![image-20200307200910623](C:\Users\45928\AppData\Roaming\Typora\typora-user-images\image-20200307200910623.png)

可以看出来，信道利用率越靠近1，时延就会越大。

## 1.2 网络模型

网络模型是将计算机网络进行分层，将庞大而复杂的问题，转化为若干较小的局部问题。因此，这些较小的局部问题就比较易于研究和处理了。

现有的网络模型有如下两个：

> 1.OSI
>
> 2.TCP/IP

模型表示如下图所示：

![image-20200307201334951](C:\Users\45928\AppData\Roaming\Typora\typora-user-images\image-20200307201334951.png)

为了综合这两个网络模型，现在有个五层的体系结构

![image-20200307201434119](C:\Users\45928\AppData\Roaming\Typora\typora-user-images\image-20200307201434119.png)

学习也是按照这五个层次来进行学习。

# 第2章 物理层

物理层需要考虑的是：如何在连接计算机的物理媒体上传输比特流。

## 2.1 基本概念

主要任务是确定与传输媒体之间接口的一些特性，比如：

**机械特性**：指明接口所用接线器的形状和尺寸、引线数目和排列、固定和锁定装置等等。

**电气特性**：指明在接口电缆的各条线上出现的电压的范围。

**功能特性**：指明某条线上出现的某一电平的电压表示何种意义。

**过程特性**：指明对于不同功能的各种可能事件的出现顺序。

几个术语：

**数据**(data)：运送消息的实体。（链路上实际传送的东西）

**信号**(signal)：数据的电气的或电磁的表现。（波）

**模拟的**(analogous)：代表消息的参数的取值是连续的。（平滑起伏的）

**数字的**(digital)：代表消息的参数的取值是离散的。（不是平滑起伏的）

**码元**(code)：在使用时间域（简称为时域）的波形来表示数字信号时，代表不同离散数值的基本波形。二进制数只有2个不同的码元：分别代表0和1。

有关信号的几个概念：

**单向通信**（单工通信）：只能有一个方向的通信而没有反方向的交互。

**双向交替通信**（半双工通信）：通信的双方都可以发送信息，但不能双方同时发送(当然也就不能同时接收)。

**双向同时通信**（全双工通信）：通信的双方可以同时发送和接收信息。

这个X工通信比较重要。

基带信号（即基本频带信号）：来自信源的信号。像计算机输出的代表各种文字或图像文件的数据信号都属于基带信号。**（没有经过载波调制的信号，网卡发出来的信号，猫之前）**
基带信号往往包含有较多的低频成分，甚至有直流成分，而许多信道并不能传输这种低频分量或直流分量。因此必须对基带信号进行调制(modulation)。
带通信号：把基带信号经过载波调制后，把信号的频率范围搬移到较高的频段以便在信道中传输（即仅在一段频率范围内能够通过信道）。 **（经过载波调制的信号，猫之后）**

下面还有几种基本的调制方法：

调幅(AM)：载波的振幅随基带数字信号而变化。 
调频(FM)：载波的频率随基带数字信号而变化。
调相(PM) ：载波的初始相位随基带数字信号而变化。

![image-20200307202449781](C:\Users\45928\AppData\Roaming\Typora\typora-user-images\image-20200307202449781.png)

利用上面那个图可以很轻易地看出来这三种调制方法的区别。

下面介绍几个重要的概念：

1.奈氏准则：在任何信道中，码元传输的速率是有上限的，超过这个限制，就会出现严重的**码间串扰**的问题，使接收端对码元的判决（即识别）成为不可能。

简单解释一下：没有干扰的情况下，码元传送速率也有上限。

2.信噪比

香农(Shannon)用信息论的理论推导出了带宽受限且有高斯白噪声干扰的信道的极限、无差错的信息传输速率。
信道的极限信息传输速率 C 可表达为
        **C = W log2(1+S/N)  b/s**
W 为信道的带宽（以 Hz 为单位）
S 为信道内所传信号的平均功率
N 为信道内部的高斯噪声功率

信道的带宽或信道中的信噪比越大，则信息的极限传输速率就越高。 
若信道带宽 W 或信噪比 S/N 没有上限（当然实际信道不可能是这样的），则信道的极限信息传输速率 C 也就没有上限。
实际信道上能够达到的信息传输速率要比香农的极限传输速率低不少。  

**香农公式的意义：只要信息传输速率低于信道的极限信息传输速率，就一定可以找到某种办法来实现无差错的传输**。 

## 2.2 传输媒体

### 2.2.1 导向传输媒体

就是传输介质

1.双绞线：用于局域网

屏蔽双绞线 STP

无屏蔽双绞线 UTP

2.同轴电缆：用于有线电视

带宽可达1GHz

3.光缆

带宽25000~30000GHz

![image-20200307203326888](C:\Users\45928\AppData\Roaming\Typora\typora-user-images\image-20200307203326888.png)

### 2.2.2 非导向传输媒体

无线传输

用的是短波、微波等。

短波是高频无线电，主要靠电离层的反射，但短波信道的通信质量较差。

微波在空间主要是直线传播。如：卫星通信、地面微波接力通信等。

## 2.3 信道复用技术*

it is very important！！！

what is 信道复用？

就是指在同一个信道当中，有多个发送端和接收端能够在同一时间段内使用这个信道。（可能不够准确，但是能够这样简单理解一下吧）。

![image-20200307203813199](C:\Users\45928\AppData\Roaming\Typora\typora-user-images\image-20200307203813199.png)

上图就能很显然地了解什么是信道复用啦。

### 2.3.1 频分复用（FDM）

频分复用是指：用户在分配到一定的贷款后，在通信过程中自始至终都独享这一个频带。

所有用户在同样的时间内，占用不同的带宽资源**（这里的带宽是指频率带宽，而不是指上面的数据发送速率）**

![image-20200307204101542](C:\Users\45928\AppData\Roaming\Typora\typora-user-images\image-20200307204101542.png)

### 2.3.2 时分复用（TDM）

时分复用是将时间划分为一段段等长的**时分复用帧（TDM帧）**，每一个时分复用的用户在每一个TDM帧中占用固定序号的时隙。

每一个用户所占用的时隙是周期性地出现的（周期就是TDM帧的长度）

TDM信号也成为等时信号。

时分复用的所有用户是在不同的时间占用同样的频带宽度。

![image-20200307204325535](C:\Users\45928\AppData\Roaming\Typora\typora-user-images\image-20200307204325535.png)

上述两种信道复用技术都可能会造成线路资源的浪费，因为有可能其中一个用户不发送信息，而他所占用的频率或时隙不会释放给别的用户用，就造成了浪费。

### 2.3.3 统计时分复用（STDM）

统计时分复用是一个改进了的时分复用，每个用户发送的数据通过**标记**来进行区分，一个统计时分复用的集中器连接4个低速用户，然后将他们的数据集中起来通过高速线路发送到一个远方的计算机。

![image-20200307204700538](C:\Users\45928\AppData\Roaming\Typora\typora-user-images\image-20200307204700538.png)

### 2.3.4 波分复用（WDM）

就是光的频分复用。。。

### 2.3.5 码分复用（CDM）*

这个很重要哦

常用的名词是**码分多址**（CDMA Code Division Multiple Access）

这个是不同用户采用相同频带在相同时间进行通信的方法。

由于各用户使用经过特殊挑选的不同码型，因此个用户之间不会造成干扰，同时，这种系统发送的信号有很强的抗干扰能力，其频谱类似于白噪声，不容易被其他人发现。

在CMDA中，每一个比特时间再被划分为m个短的间隔，这个间隔就是一个0或一个1。间隔被称为码片。

使用CDMA的每一个站被指派一个唯一的m bit的码片序列。

如发送比特 1，则发送自己的 m bit 码片序列。
如发送比特 0，则发送该码片序列的二进制反码。 

例如，S 站的 8 bit 码片序列是 00011011。
发送比特 1 时，就发送序列 00011011，
发送比特 0 时，就发送序列 11100100。

每个站分配的码片序列不仅必须各不相同，并且还必须相互正交，在实际系统中是使用伪随机码序列。

令向量 S 表示站 S 的码片向量，令 T 表示其他任何站的码片向量。 
两个不同站的码片序列正交，就是向量 S 和T 的规格化内积(inner product)都是 0

![image-20200307210149864](C:\Users\45928\AppData\Roaming\Typora\typora-user-images\image-20200307210149864.png)

例如：

令向量 S 为(–1 –1 –1 +1 +1 –1 +1 +1)，
    向量 T 为(–1 –1 +1 –1 +1 +1 +1 –1)。 
把向量 S 和 T 的各分量值代入(2-3)式就可看出这两个码片序列是正交的。 

任何一个码片向量和该码片向量自己的规格化内积都是1.

一个码片向量和该码片反码的向量的规格化内积值是-1。

举个例子，现在有一个基站，两个手机

基站发送的和向量是S，两个手机的码片向量是P1和P2

如果S想向P1发送信息的话，S发送的信息必须满足下面的一个要求：

发送1：S·P1 = 1

发送0：S·P1 = 0

这个码片向量与P2的规格化内积是0：S·P2 = 0

当某个站点想要接受站点X发送的数据时，首先必须知道X的码片序列

### 总结

第二章的主要内容就是这些了，上面的需要全部记住最重要的就是2.3，最最重要的就是2.3.5这个CDMA

# 第3章 数据链路层

数据链路层属于计算机网络的低层，使用的信道主要有以下两种类型：

1. 点对点信道。这种信道使用一对一的点对点通信方式。
2. 广播信道。这种信道使用一对多的广播通信方式，因此过程比较复杂。广播信道上连接的主机很多，因此必须使用专用的共享信道协议来协调这些主机的数据发送。

本章最重要的内容如下：

1. 数据链路层的点对点信道和广播信道的特点，以及这两种信道所使用的协议（PPP协议以及CSMA/CD协议）的特点
2. 数据链路层的三个基本问题：**封装成帧、透明传输、差错检测。**
3. 以太网MAC层的硬件地址。
4. 适配器、转发器、集线器、网桥、以太网交换机的作用以及使用场合

## 3.1 使用点对点信道的数据链路层

### 3.1.1 数据链路和帧

链路(link)是一条无源的点到点的物理线路段，**中间没有任何其他的交换结点**。

​	一条链路只是一条通路的一个组成部分。

数据链路(data link) 除了物理线路外，还必须有通信协议来控制这些数据的传输。若把**实现这些协议的硬件和软件加到链路上**，就构成了数据链路。

​	现在最常用的方法是使用网络适配器（即网卡）来实现这些协议的硬件和软件。
​	一般的适配器都包括了数据链路层和物理层这两层的功能。  

点对点信道的数据链路层的协议数据单元——**帧**

<img src="C:\Users\45928\AppData\Roaming\Typora\typora-user-images\image-20200316105949436.png" alt="image-20200316105949436" style="zoom: 50%;" />

### 3.1.2 三个基本问题

1.封装成帧

封装成帧就是在一段数据的前后分别添加首部和尾部，然后就构成了一个帧。

首部和尾部的一个主要作用就是进行帧定界（即确定帧的界限）。使比特流有意义。

<img src="C:\Users\45928\AppData\Roaming\Typora\typora-user-images\image-20200316110147148.png" alt="image-20200316110147148" style="zoom: 50%;" />

2.透明传输

由于帧的开始和结束的标记是使用专门指明的控制字符，因此，所传输的数据中心的任何8比特的组合一定不允许使用和作为帧定界的控制字符的比特编码一样，否则就会出现帧定界的错误。

<img src="C:\Users\45928\AppData\Roaming\Typora\typora-user-images\image-20200316110334380.png" alt="image-20200316110334380" style="zoom:50%;" />

帧定界错误的示例：数据部分出现了与帧定界控制字符相同的字符

所谓“透明”就是在数据部分的“SOH”或者“EOT”前面加上转义字符“ESC”，这种方法称为**字节填充**或**字符填充**

<img src="C:\Users\45928\AppData\Roaming\Typora\typora-user-images\image-20200316110558966.png" alt="image-20200316110558966" style="zoom:50%;" />

3.差错检测

显示的通信链路都不会是理想的，因此，比特在传输过程中可能会产生比特差错：1 可能会变成 0，而 0 也可能变成 1。

在一段时间内，传输错误的比特占所传输比特总数的比率称为**误码率** BER (Bit Error Rate)。

误码率与信噪比有很大的关系。

为了保证数据传输的可靠性，在计算机网络传输数据时，必须采用各种差错检测措施。

目前在数据链路层广泛使用了**循环冗余检验 CRC**的检错技术



（1）冗余码：

在发送端，先把二进制数据划分为组。假定每组 k 个比特。 
假设待传送的一组数据 M = 101001（现在 k = 6）。我们在 M 的后面再添加供差错检测用的 n 位**冗余码**一起发送。  

用二进制的模 2 运算进行 2的n次方 乘 M 的运算，这相当于在 M 后面添加 n 个 0。
得到的 (k + n) 位的数除以事先选定好的长度为 (n + 1) 位的除数 P，得出商是 Q 而余数是 R，余数 R 比除数 P 少1 位，即 R 是 n 位。 

这种为了进行检错而添加的冗余码称为**帧检验序列 FCS**。因此加上FCS后发送的帧是101001001（即2的n次方乘以M + FCS）共有（k + n）位。

<img src="C:\Users\45928\AppData\Roaming\Typora\typora-user-images\image-20200316111447230.png" alt="image-20200316111447230" style="zoom:50%;" />

（2）CRC检验：

在接收端把接收到的数据以帧为单位进行CRC检验：把收到的每一个帧都除以同样的除数P（模2运算），然后检查得到的余数R。

如果在传输过程中无差错，那么经过CRC检验后得出的余数R一定是0，同样，如果出现误码，余数R仍然是0的概率非常非常小。

总之，在接收端对收到的每一帧经过CRC检验后，有以下两种情况：

1. 若得出的余数 R = 0，则判定这个帧没有差错，就接受(accept)。

2. 若余数 R ！= 0，则判定这个帧有差错，就丢弃。



注：

CRC 是一种常用的检错方法，而 FCS 是添加在数据后面的冗余码。
FCS 可以用 CRC 这种方法得出，但 CRC 并非用来获得 FCS 的唯一方法。  



只要经过严格的挑选，并使用位数足够多的除数 P，那么出现检测不到的差错的概率就很小很小。
这种检测方法并**不能确定究竟是哪一个或哪几个比特出现了差错**。
在数据链路层，**发送端的FCS生成和接收端的CRC检测都是用硬件实现**的，处理速度很快，不会延误数据传输。



综上：循环冗余检验CRC差错检测技术只能做到**无差错接收**。

“无差错接受”是指：“凡是接受的帧（即不包括丢弃的帧），我们都能以非常接近于 1 的概率认为这些帧在传输过程中没有产生差错”。
也就是说：“凡是接收端数据链路层接受的帧都没有传输差错”（有差错的帧就丢弃而不接受）。
要做到“可靠传输”（即发送什么就收到什么）就必须再加上确认和重传机制（这个就是运输层的事情了如TCP协议）。

## 3.2 点对点协议PPP

我们知道，因特网用户通常都要连接到某个ISP才能接入到因特网。PPP协议就是用户计算机和ISP进行通信时所使用的数据链路层协议。

<img src="C:\Users\45928\AppData\Roaming\Typora\typora-user-images\image-20200316112355405.png" alt="image-20200316112355405" style="zoom:50%;" />

### 3.2.1 PPP协议应满足的要求

（1）简单——这是首要的要求
（2）封装成帧：PPP协议必须规定特殊的字符作为帧定界符
（3）透明性：必须保证数据传输的透明性。也就是说，如果数据中碰巧出现和帧定界符一样的比特组合时，必须采取有效的措施解决这个问题。
（4）多种网络层协议：必须能够在同一条物理链路上同时支持多种网络协议（如IP和IPX等）的运行。当点对点链路连接的是局域网或路由器时，PPP协议必须同时支持在链路所连接的局域网或路由器上运行的各种网络层协议。
（5）多种类型链路：除了支持多种网络协议以外，还必须能够在多种类型的链路上运行。例如：串行的（一次发送一个比特）、并行的（一次并行发送多个比特）、同步或异步的、低速或高速的······
（6）差错检测：必须能够对接收端收到的帧进行检测，并立即丢弃有差错的帧。
（7）检测连接状态：及时自动检测出链路是否处于正常工作状态。
（8）最大传送单元：必须对每一种类型的点对点链路设置最大传送单元MTU的标准默认值。
（9）网络层地址协商
（10）数据压缩协商 

### 3.2.2 PPP协议的组成

（1）一个将 IP 数据报封装到串行链路的方法：PPP既支持异步链路（无奇偶检验的8比特数据），也支持面向比特的同步链路。IP数据包在PPP帧中就是其信息部分。这信息部分的长度受最大传送单元MTU的限制。
（2）链路控制协议 LCP (Link Control Protocol)：用来建立、配置和测试数据链路连接的协议。
（3）网络控制协议 NCP (Network Control Protocol)：其中的每一个协议支持不同的网络层协议。

### 3.2.3 PPP协议的帧格式

1.各字段的意义

标志字段 F = 0x7E （符号“0x”表示后面的字符是用十六进制表示。十六进制的 7E 的二进制表示是 01111110）。
地址字段 A 只置为 0xFF。地址字段实际上并不起作用。
控制字段 C 通常置为 0x03。
PPP 是面向字节的，所有的 PPP 帧的长度都是整数字节。

![image-20200316113422252](C:\Users\45928\AppData\Roaming\Typora\typora-user-images\image-20200316113422252.png)

PPP 有一个 2 个字节的协议字段。
当协议字段为 0x0021 时，PPP 帧的信息字段就是IP 数据报。
若为 0xC021, 则信息字段是 PPP 链路控制数据。
若为 0x8021，则表示这是网络控制数据。
若为 0xC021, 则信息字段是 Apple Talk协议数据包。
等等

2.字节填充

当信息字段中出现和标志字段一样的比特（0x7E）组合时，就必须采取一些措施使这种形式上和标志字段一样的比特组合不出现在信息字段中。

当PPP使用异步传输时，他把转义符定义为0x7D，并使用**字节填充**

填充方法如下：

将信息字段中出现的每一个 0x7E 字节转变成为 2 字节序列(0x7D, 0x5E)。 
若信息字段中出现一个 0x7D 的字节, 则将其转变成为 2 字节序列(0x7D, 0x5D)。
若信息字段中出现 ASCII 码的控制字符（即数值小于 0x20 的字符），则在该字符前面要加入一个 0x7D 字节。

3.零比特填充

PPP 协议用在 SONET/SDH 链路时，是使用同步传输（一连串的比特连续传送）。这时 PPP 协议采用零比特填充方法来实现透明传输。

具体做法如下：

在发送端，只要发现有 5 个连续 1，则立即填入一个 0。接收端对帧中的比特流进行扫描。每当发现 5 个连续1时，就把这 5 个连续 1 后的一个 0 删除，

<img src="C:\Users\45928\AppData\Roaming\Typora\typora-user-images\image-20200316113813228.png" alt="image-20200316113813228" style="zoom:50%;" />

### 3.2.4 PPP协议的工作状态

（1）当用户拨号接入 ISP 时，路由器的调制解调器对拨号做出确认，并建立一条物理连接。
（2）PC 机向路由器发送一系列的 LCP 分组（封装成多个 PPP 帧）。
（3）这些分组及其响应选择一些 PPP 参数，和进行网络层配置，NCP 给新接入的 PC机分配一个临时的 IP 地址，使 PC 机成为因特网上的一个主机。
（4）通信完毕时，NCP 释放网络层连接，收回原来分配出去的 IP 地址。接着，LCP 释放数据链路层连接。最后释放的是物理层的连接。

<img src="C:\Users\45928\AppData\Roaming\Typora\typora-user-images\image-20200316113948306.png" alt="image-20200316113948306" style="zoom:50%;" />

## 3.3 使用广播信道的数据链路层（总线型网络）